drop table if exists biomarker_region;
CREATE TABLE biomarker_regions (
    id                                   integer primary key GENERATED BY DEFAULT AS identity
    , survey_id                          integer REFERENCES survey (id)
    , name                               text
    , aggregation_area                   integer REFERENCES aggregation_area(id)
);

INSERT INTO biomarker_region (survey_id, name, aggregation_area) values 
 (2, 'Northern Region', (SELECT id from aggregation_area where name = 'Chitipa'))
,(2, 'Northern Region', (SELECT id from aggregation_area where name = 'Karonga'))
,(2, 'Northern Region', (SELECT id from aggregation_area where name = 'Likoma'))
,(2, 'Northern Region', (SELECT id from aggregation_area where name = 'Mzimba'))
,(2, 'Northern Region', (SELECT id from aggregation_area where name = 'Nkhata Bay'))
,(2, 'Northern Region', (SELECT id from aggregation_area where name = 'Rumphi'))

,(2, 'Central Region', (SELECT id from aggregation_area where name = 'Dedza'))
,(2, 'Central Region', (SELECT id from aggregation_area where name = 'Dowa'))
,(2, 'Central Region', (SELECT id from aggregation_area where name = 'Kasungu'))
,(2, 'Central Region', (SELECT id from aggregation_area where name = 'Lilongwe'))
,(2, 'Central Region', (SELECT id from aggregation_area where name = 'Mchinji'))
,(2, 'Central Region', (SELECT id from aggregation_area where name = 'Nkhotakota'))
,(2, 'Central Region', (SELECT id from aggregation_area where name = 'Ntcheu'))
,(2, 'Central Region', (SELECT id from aggregation_area where name = 'Ntchisi'))
,(2, 'Central Region', (SELECT id from aggregation_area where name = 'Salima'))

,(2, 'Southern Region', (SELECT id from aggregation_area where name = 'Balaka'))
,(2, 'Southern Region', (SELECT id from aggregation_area where name = 'Blantyre'))
,(2, 'Southern Region', (SELECT id from aggregation_area where name = 'Chikwawa'))
,(2, 'Southern Region', (SELECT id from aggregation_area where name = 'Chiradzulu'))
,(2, 'Southern Region', (SELECT id from aggregation_area where name = 'Machinga'))
,(2, 'Southern Region', (SELECT id from aggregation_area where name = 'Mangochi'))
,(2, 'Southern Region', (SELECT id from aggregation_area where name = 'Mulanje'))
,(2, 'Southern Region', (SELECT id from aggregation_area where name = 'Mwanza'))
,(2, 'Southern Region', (SELECT id from aggregation_area where name = 'Nsanje'))
,(2, 'Southern Region', (SELECT id from aggregation_area where name = 'Thyolo'))
,(2, 'Southern Region', (SELECT id from aggregation_area where name = 'Phalombe'))
,(2, 'Southern Region', (SELECT id from aggregation_area where name = 'Zomba'))
,(2, 'Southern Region', (SELECT id from aggregation_area where name = 'Neno'));


CREATE OR REPLACE VIEW biomarker_aggregation_area as (
    select 
        survey_id
        , br.name
        , ST_UNION(geometry) as geometry
    FROM 
    	biomarker_region br
    join aggregation_area aa on aa.id = br.aggregation_area 
    group by 
        survey_id,
        br.name
)